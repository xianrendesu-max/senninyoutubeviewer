<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>仙人YouTubeビュアー</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{margin:0;background:#f5f6f8;font-family:system-ui}
.banner{display:flex;gap:8px;padding:10px;background:#fff;position:sticky;top:0}
.banner button{flex:1;padding:10px;border-radius:10px;border:1px solid #ccc}
.banner button.active{background:#4f46e5;color:#fff}
.video-wrap{background:#000}
iframe{width:100%;height:240px;border:none}
.section{background:#fff;margin:12px;padding:12px;border-radius:12px}
.download-btn{padding:10px 14px;border-radius:10px;background:#16a34a;color:#fff;border:none}
.instance-bar{margin-top:8px;font-size:12px;color:#555}
</style>
</head>
<body>

<div class="banner">
<button onclick="setPlayer('nocookie')" id="b1">nocookie</button>
<button onclick="setPlayer('embed')" id="b2">embed</button>
<button onclick="setPlayer('education')" id="b3">education</button>
</div>

<div class="video-wrap">
<img id="thumb" style="width:100%">
<iframe id="player" allowfullscreen></iframe>
</div>

<div class="section">
<h2 id="title">読み込み中...</h2>
<button class="download-btn" onclick="loadDownload()">⬇ ダウンロード</button>
<div id="downloads"></div>
<div class="instance-bar" id="inst"></div>
</div>

<script>
const v=new URLSearchParams(location.search).get("v")
const player=document.getElementById("player")
document.getElementById("thumb").src=`https://i.ytimg.com/vi/${v}/hqdefault.jpg`

let EMBED=""

fetch("/api/instance/embed").then(r=>r.json()).then(d=>{
  EMBED=d.instance
  document.getElementById("inst").textContent="Embed: "+EMBED
})

function setPlayer(t){
  document.querySelectorAll("button").forEach(b=>b.classList.remove("active"))
  if(t==="nocookie"){player.src=`https://www.youtube-nocookie.com/embed/${v}`;b1.classList.add("active")}
  if(t==="embed"){player.src=`${EMBED}/embed/${v}`;b2.classList.add("active")}
  if(t==="education"){player.src=`https://www.youtubeeducation.com/embed/${v}`;b3.classList.add("active")}
}
setPlayer("nocookie")

fetch(`/api/video?video_id=${v}`).then(r=>r.json()).then(d=>{
  title.textContent=d.title
})

function loadDownload(){
 fetch(`/api/download?video_id=${v}`).then(r=>r.json()).then(d=>{
  downloads.innerHTML=""
  d.formats.forEach(f=>{
   const a=document.createElement("a")
   a.href=f.url
   a.target="_blank"
   a.textContent=`${f.quality||"audio"} (${f.type})`
   downloads.appendChild(a)
  })
 })
}
</script>
</body>
</html>
